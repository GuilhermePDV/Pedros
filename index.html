<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro - Barbearia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>

    <!-- Firebase (deve vir antes do seu script principal) -->
    <!-- Firebase App (base) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
      // Configura√ß√£o do Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyD3ScwfW4Ld2WV6QCntph6HdvhT3xztZzU",
        authDomain: "barbearia-a66e9.firebaseapp.com",
        projectId: "barbearia-a66e9",
        storageBucket: "barbearia-a66e9.firebasestorage.app",
        messagingSenderId: "30136159716",
        appId: "1:30136159716:web:05770f391df96196464bf1"
      };

      // Inicializar Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üíà Pedro's Barbearia</h1>
            <p class="text-purple-200">Sistema de Controle por Barbeiro</p>
        </div>

        <!-- Barber Selection -->
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl font-bold text-white">Selecionar Barbeiro</h2>
                    <p class="text-purple-200 text-sm">Escolha o barbeiro para visualizar os dados</p>
                </div>
                <div class="flex items-center gap-4">
                    <select id="barberSelect" 
                            class="px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            style="background-color: rgba(255,255,255,0.1) !important; color: white !important;">
                        <option value="barbeiro1" style="background-color: #1e293b; color: white;">Barbeiro 1</option>
                        <option value="barbeiro2" style="background-color: #1e293b; color: white;">Barbeiro 2</option>
                        <option value="barbeiro3" style="background-color: #1e293b; color: white;">Barbeiro 3</option>
                        <option value="barbeiro4" style="background-color: #1e293b; color: white;">Barbeiro 4</option>
                        <option value="barbeiro5" style="background-color: #1e293b; color: white;">Barbeiro 5</option>
                    </select>
                    <button onclick="editBarberName()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm">
                        ‚úèÔ∏è Editar Nome
                    </button>
                    <button onclick="showAllBarbers()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg text-sm">
                        üìä Ver Todos
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-200 text-sm">Barbeiro Ativo</p>
                        <p class="text-2xl font-bold text-white" id="activeBarberId">Barbeiro 1</p>
                    </div>
                    <div class="text-4xl">üíà</div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-200 text-sm">Total de Clientes</p>
                        <p class="text-3xl font-bold text-white" id="totalClients">0</p>
                    </div>
                    <div class="text-4xl">üë•</div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-200 text-sm">Receita Total</p>
                        <p class="text-3xl font-bold text-green-400" id="totalRevenue">R$ 0,00</p>
                    </div>
                    <div class="text-4xl">üí∞</div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-200 text-sm">Servi√ßos Realizados</p>
                        <p class="text-3xl font-bold text-white" id="totalServices">0</p>
                    </div>
                    <div class="text-4xl">‚úÇÔ∏è</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Add Client Form -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <h2 class="text-2xl font-bold text-white mb-6">Adicionar Cliente</h2>
                <form id="clientForm" class="space-y-4">
                    <div>
                        <label class="block text-purple-200 text-sm font-medium mb-2">Barbeiro</label>
                        <select id="clientBarber" required 
                                class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                style="background-color: rgba(255,255,255,0.1) !important; color: white !important;">
                            <option value="barbeiro1" style="background-color: #1e293b; color: white;">Barbeiro 1</option>
                            <option value="barbeiro2" style="background-color: #1e293b; color: white;">Barbeiro 2</option>
                            <option value="barbeiro3" style="background-color: #1e293b; color: white;">Barbeiro 3</option>
                            <option value="barbeiro4" style="background-color: #1e293b; color: white;">Barbeiro 4</option>
                            <option value="barbeiro5" style="background-color: #1e293b; color: white;">Barbeiro 5</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-purple-200 text-sm font-medium mb-2">Nome do Cliente</label>
                        <input type="text" id="clientName" required 
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="Digite o nome do cliente">
                    </div>
                    <div>
                        <label class="block text-purple-200 text-sm font-medium mb-2">Telefone</label>
                        <input type="tel" id="clientPhone" 
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="(11) 99999-9999">
                    </div>
                    <div>
                        <label class="block text-purple-200 text-sm font-medium mb-2">Pacote de Servi√ßo</label>
                        <select id="servicePackage" required 
                                class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                style="background-color: rgba(255,255,255,0.1) !important; color: white !important;">
                            <option value="" style="background-color: #1e293b; color: white;">Selecione um pacote</option>
                            <option value="cabelo-barba" data-price="200" style="background-color: #1e293b; color: white;">Pacote Cabelo + Barba (4x/m√™s) - R$ 200,00</option>
                            <option value="cabelo" data-price="120" style="background-color: #1e293b; color: white;">Pacote S√≥ Cabelo (4x/m√™s) - R$ 120,00</option>
                            <option value="barba" data-price="100" style="background-color: #1e293b; color: white;">Pacote S√≥ Barba (4x/m√™s) - R$ 100,00</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-purple-200 text-sm font-medium mb-2">Data do Servi√ßo</label>
                        <input type="date" id="serviceDate" required 
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105">
                        Adicionar Cliente
                    </button>
                </form>
            </div>

            <!-- Package Prices -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Pacotes de Servi√ßos</h2>
                    <button onclick="addNewPackage()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                        ‚ûï Novo Pacote
                    </button>
                </div>
                <div id="packagesContainer" class="space-y-4">
                    <!-- Packages will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Clients Table -->
        <div class="mt-8 bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Hist√≥rico de Clientes</h2>
                <div class="flex space-x-2">
                    <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                        üìä Exportar
                    </button>
                    <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm">
                        üóëÔ∏è Limpar Tudo
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/20">
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Barbeiro</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Cliente</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Telefone</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Servi√ßo</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Data</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">Valor</th>
                            <th class="text-left text-purple-200 font-semibold py-3 px-2">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTable">
                        <tr>
                            <td colspan="7" class="text-center text-purple-300 py-8">
                                Nenhum cliente cadastrado ainda
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>



    <!-- Edit Barber Name Modal -->
    <div id="editBarberModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 w-96 mx-4">
            <h3 class="text-xl font-bold text-white mb-4">Editar Nome do Barbeiro</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Barbeiro Selecionado</label>
                    <p id="selectedBarberName" class="text-white font-semibold"></p>
                </div>
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Novo Nome</label>
                    <input type="text" id="newBarberName" placeholder="Digite o novo nome"
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveBarberName()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg">
                        Salvar
                    </button>
                    <button onclick="closeBarberModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Package Modal -->
    <div id="packageModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 w-96 mx-4">
            <h3 id="packageModalTitle" class="text-xl font-bold text-white mb-4">Novo Pacote</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Nome do Pacote</label>
                    <input type="text" id="packageName" placeholder="Ex: Cabelo + Barba"
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Descri√ß√£o</label>
                    <input type="text" id="packageDescription" placeholder="Ex: 4 cortes completos por m√™s"
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Pre√ßo (R$)</label>
                    <input type="number" id="packagePrice" step="0.01" min="0" placeholder="200.00"
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-purple-200 text-sm font-medium mb-2">Emoji/√çcone</label>
                    <input type="text" id="packageIcon" placeholder="‚úÇÔ∏èüíà" maxlength="10"
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="flex space-x-3">
                    <button onclick="savePackage()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg">
                        Salvar
                    </button>
                    <button onclick="closePackageModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage (clientes agora v√™m do Firestore)
        let clients = [];
        let packages = JSON.parse(localStorage.getItem('servicePackages') || '{"cabelo-barba": {"name": "Pacote Cabelo + Barba", "description": "4 cortes completos por m√™s", "price": 200, "icon": "‚úÇÔ∏èüíà"}, "cabelo": {"name": "Pacote S√≥ Cabelo", "description": "4 cortes de cabelo por m√™s", "price": 120, "icon": "‚úÇÔ∏è"}, "barba": {"name": "Pacote S√≥ Barba", "description": "4 barbas por m√™s", "price": 100, "icon": "üíà"}}');
        let barberNames = JSON.parse(localStorage.getItem('barberNames') || '{"barbeiro1": "Barbeiro 1", "barbeiro2": "Barbeiro 2", "barbeiro3": "Barbeiro 3", "barbeiro4": "Barbeiro 4", "barbeiro5": "Barbeiro 5"}');
        let editingPackage = null;
        let currentBarber = 'barbeiro1';
        let showingAllBarbers = false;

        // ---- Firestore: carregar clientes do banco ----
function loadClients() {
  db.collection("clients")
    .orderBy("date", "desc")
    .onSnapshot(snapshot => {
      clients = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        const price = typeof data.price === "number" ? data.price : parseFloat(data.price) || 0;
        clients.push({ id: doc.id, ...data, price });
      });
      updateStats();
      renderClientsTable();
    }, err => {
      console.error("Erro ao carregar clientes:", err);
    });
}


        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateBarberNames();
            updateStats();
            renderClientsTable();
            renderPackages();
            updateServiceSelect();
            
            // Set today's date as default
            document.getElementById('serviceDate').valueAsDate = new Date();
            
            // Set default barber in form
            document.getElementById('clientBarber').value = currentBarber;
            
            // Add event listener for barber selection
            document.getElementById('barberSelect').addEventListener('change', function() {
                currentBarber = this.value;
                showingAllBarbers = false;
                document.getElementById('clientBarber').value = currentBarber;
                updateStats();
                renderClientsTable();
                updateActiveBarberId();
            });

            // Carregar clientes do Firestore ao abrir
            loadClients();
        });

        // Form submission -> salvar no Firestore
        document.getElementById('clientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const barber = document.getElementById('clientBarber').value;
            const name = document.getElementById('clientName').value;
            const phone = document.getElementById('clientPhone').value;
            const servicePackage = document.getElementById('servicePackage').value;
            const serviceDate = document.getElementById('serviceDate').value;
            
            const packageData = packages[servicePackage];
            const price = packageData.price;
            const serviceName = packageData.name;
            
            const client = {
                barber,
                name,
                phone,
                service: serviceName,
                serviceType: servicePackage,
                date: serviceDate,
                price: price
            };
            
            try {
              const docRef = await db.collection("clients").add(client);
              // atualiza a lista local e a UI
              clients.push({ id: docRef.id, ...client });
              updateStats();
              renderClientsTable();
              console.log("Cliente adicionado com sucesso!");
            } catch (error) {
              console.error("Erro ao adicionar cliente: ", error);
              alert("N√£o foi poss√≠vel salvar no banco agora.");
            }
            
            // Reset form
            this.reset();
            document.getElementById('serviceDate').valueAsDate = new Date();

            // Feedback visual
            const button = document.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.textContent = '‚úÖ Cliente Adicionado!';
            button.classList.add('bg-green-600');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600');
            }, 2000);
        });

        function updateStats() {
            let filteredClients = clients;
            
            if (!showingAllBarbers) {
                filteredClients = clients.filter(client => client.barber === currentBarber);
            }
            
            document.getElementById('totalClients').textContent = filteredClients.length;
            document.getElementById('totalServices').textContent = filteredClients.length;
            
            const totalRevenue = filteredClients.reduce((sum, client) => sum + client.price, 0);
            document.getElementById('totalRevenue').textContent = `R$ ${totalRevenue.toFixed(2).replace('.', ',')}`;
        }

        function updateActiveBarberId() {
            const barberName = showingAllBarbers ? 'Todos os Barbeiros' : barberNames[currentBarber];
            document.getElementById('activeBarberId').textContent = barberName;
        }

        function renderClientsTable() {
            const tbody = document.getElementById('clientsTable');
            
            let filteredClients = clients;
            if (!showingAllBarbers) {
                filteredClients = clients.filter(client => client.barber === currentBarber);
            }
            
            if (filteredClients.length === 0) {
                const message = showingAllBarbers ? 'Nenhum cliente cadastrado ainda' : 
                               `Nenhum cliente cadastrado para ${barberNames[currentBarber]}`;
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-purple-300 py-8">
                            ${message}
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredClients.map(client => {
                const barberName = barberNames[client.barber] || client.barber;
                return `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="py-3 px-2 text-purple-300">${barberName}</td>
                        <td class="py-3 px-2 text-white">${client.name}</td>
                        <td class="py-3 px-2 text-purple-200">${client.phone || '-'}</td>
                        <td class="py-3 px-2 text-white">${client.service}</td>
                        <td class="py-3 px-2 text-purple-200">${new Date(client.date).toLocaleDateString('pt-BR')}</td>
                        <td class="py-3 px-2 text-green-400 font-semibold">R$ ${client.price.toFixed(2).replace('.', ',')}</td>
                        <td class="py-3 px-2">
                            <!-- id do Firestore √© string: passar entre aspas -->
                            <button onclick="deleteClient('${client.id}')" 
                                    class="text-red-400 hover:text-red-300 text-sm">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Exclus√£o no Firestore
        async function deleteClient(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                try {
                    await db.collection("clients").doc(String(id)).delete();
                    clients = clients.filter(client => client.id !== id);
                    updateStats();
                    renderClientsTable();
                } catch (err) {
                    console.error('Erro ao excluir:', err);
                    alert('N√£o foi poss√≠vel excluir agora.');
                }
            }
        }

        function renderPackages() {
            const container = document.getElementById('packagesContainer');
            container.innerHTML = Object.keys(packages).map(packageId => {
                const pkg = packages[packageId];
                return `
                    <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${pkg.icon}</span>
                            <div>
                                <h3 class="text-white font-semibold">${pkg.name}</h3>
                                <p class="text-purple-200 text-sm">${pkg.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-green-400 font-bold text-lg">R$ ${pkg.price.toFixed(2).replace('.', ',')}</p>
                            <div class="flex space-x-2 mt-1">
                                <button onclick="editPackage('${packageId}')" class="text-purple-300 hover:text-white text-sm">Editar</button>
                                <button onclick="deletePackage('${packageId}')" class="text-red-400 hover:text-red-300 text-sm">Excluir</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateServiceSelect() {
            const select = document.getElementById('servicePackage');
            // Keep the first empty option
            const emptyOption = select.querySelector('option[value=""]');
            select.innerHTML = '';
            select.appendChild(emptyOption);
            
            Object.keys(packages).forEach(packageId => {
                const pkg = packages[packageId];
                const option = document.createElement('option');
                option.value = packageId;
                option.textContent = `${pkg.name} - R$ ${pkg.price.toFixed(2).replace('.', ',')}`;
                option.style.backgroundColor = '#1e293b';
                option.style.color = 'white';
                select.appendChild(option);
            });
        }

        function addNewPackage() {
            editingPackage = null;
            document.getElementById('packageModalTitle').textContent = 'Novo Pacote';
            document.getElementById('packageName').value = '';
            document.getElementById('packageDescription').value = '';
            document.getElementById('packagePrice').value = '';
            document.getElementById('packageIcon').value = '';
            document.getElementById('packageModal').classList.remove('hidden');
            document.getElementById('packageModal').classList.add('flex');
        }

        function editPackage(packageId) {
            editingPackage = packageId;
            const pkg = packages[packageId];
            document.getElementById('packageModalTitle').textContent = 'Editar Pacote';
            document.getElementById('packageName').value = pkg.name;
            document.getElementById('packageDescription').value = pkg.description;
            document.getElementById('packagePrice').value = pkg.price;
            document.getElementById('packageIcon').value = pkg.icon;
            document.getElementById('packageModal').classList.remove('hidden');
            document.getElementById('packageModal').classList.add('flex');
        }

        function closePackageModal() {
            document.getElementById('packageModal').classList.add('hidden');
            document.getElementById('packageModal').classList.remove('flex');
            editingPackage = null;
        }

        function savePackage() {
            const name = document.getElementById('packageName').value.trim();
            const description = document.getElementById('packageDescription').value.trim();
            const price = parseFloat(document.getElementById('packagePrice').value);
            const icon = document.getElementById('packageIcon').value.trim();

            if (!name || !description || !price || price <= 0) {
                alert('Por favor, preencha todos os campos corretamente.');
                return;
            }

            const packageId = editingPackage || name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
            
            packages[packageId] = {
                name: name,
                description: description,
                price: price,
                icon: icon || 'üì¶'
            };

            localStorage.setItem('servicePackages', JSON.stringify(packages));
            renderPackages();
            updateServiceSelect();
            closePackageModal();

            const action = editingPackage ? 'editado' : 'criado';
            alert(`‚úÖ Pacote ${action} com sucesso!`);
        }

        function deletePackage(packageId) {
            if (confirm(`Tem certeza que deseja excluir o pacote "${packages[packageId].name}"?`)) {
                delete packages[packageId];
                localStorage.setItem('servicePackages', JSON.stringify(packages));
                renderPackages();
                updateServiceSelect();
                alert('‚úÖ Pacote exclu√≠do com sucesso!');
            }
        }

        function exportData() {
            const data = {
                clients: clients,
                packages: packages,
                barberNames: barberNames,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `barbearia-dados-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° apagar TODOS os dados permanentemente. Tem certeza?')) {
                if (confirm('√öltima confirma√ß√£o: Todos os clientes e dados ser√£o perdidos. Continuar?')) {
                    clients = [];
                    localStorage.removeItem('barberClients'); // continua apenas no local
                    updateStats();
                    renderClientsTable();
                    alert('‚úÖ Todos os dados foram limpos!');
                }
            }
        }

        function showAllBarbers() {
            showingAllBarbers = true;
            currentBarber = null;
            updateStats();
            renderClientsTable();
            updateActiveBarberId();
        }

        function updateBarberNames() {
            // Update both select elements
            const selects = ['barberSelect', 'clientBarber'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    const barberId = option.value;
                    if (barberNames[barberId]) {
                        option.textContent = barberNames[barberId];
                    }
                });
            });
            updateActiveBarberId();
        }

        function editBarberName() {
            if (showingAllBarbers) {
                alert('Selecione um barbeiro espec√≠fico para editar o nome.');
                return;
            }
            
            document.getElementById('selectedBarberName').textContent = barberNames[currentBarber];
            document.getElementById('newBarberName').value = barberNames[currentBarber];
            document.getElementById('editBarberModal').classList.remove('hidden');
            document.getElementById('editBarberModal').classList.add('flex');
        }

        function closeBarberModal() {
            document.getElementById('editBarberModal').classList.add('hidden');
            document.getElementById('editBarberModal').classList.remove('flex');
        }

        function saveBarberName() {
            const newName = document.getElementById('newBarberName').value.trim();
            if (newName && newName.length > 0) {
                barberNames[currentBarber] = newName;
                localStorage.setItem('barberNames', JSON.stringify(barberNames));
                updateBarberNames();
                renderClientsTable();
                closeBarberModal();
                
                // Success feedback
                alert(`‚úÖ Nome alterado para: ${newName}`);
            } else {
                alert('Por favor, digite um nome v√°lido.');
            }
        }

        // Close modal when clicking outside
        document.getElementById('editBarberModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBarberModal();
            }
        });

        document.getElementById('packageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePackageModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e9a4c370d7f1f5',t:'MTc1NTEwMzExNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

